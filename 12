local player = game.Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RemoteEvent = ReplicatedStorage.Events.Remote.ShotTarget
local SoundService = game:GetService("SoundService")

local targetTeamName = "Red" -- Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§
local cooldown = 0 -- Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ù‚Ø§Øª
local bulletSpeed = 49.5 -- Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ØµØ§ØµØ©
local minPredictionDistance = 0
local maxPredictionDistance = 10
local lastShotTime = 0

-- Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
local function displayNotification(message)
    local notification = Instance.new("ScreenGui")
    notification.Name = "Ø¥Ø´Ø¹Ø§Ø±"

    local textLabel = Instance.new("TextLabel")
    textLabel.Parent = notification
    textLabel.Size = UDim2.new(0, 250, 0, 50)
    textLabel.Position = UDim2.new(0.5, -125, 0.5, -25)
    textLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.Text = message
    textLabel.TextSize = 20
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)

    notification.Parent = player.PlayerGui

    wait(2) -- Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    notification:Destroy()
end

-- Ø¯Ø§Ù„Ø© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
local function playSound(soundId, delay)
    delay = delay or 0
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://" .. soundId
    sound.Parent = SoundService
    sound:Play()
    wait(delay)
    sound:Destroy()
end

-- ØªØ´ØºÙŠÙ„ Ø£ØµÙˆØ§Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
spawn(function()
    playSound(2865227271, 0.5)
    wait(0.5)
    playSound(1676318332)
end)

-- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
local function findClosestPlayer()
    local players = game.Players:GetPlayers()
    local closestPlayer = nil
    local shortestDistance = math.huge

    local tool = player.Character and player.Character:FindFirstChildOfClass("Tool")
    if tool and tool:FindFirstChild("Handle") then
        local shooterPosition = tool.Handle.Position

        for _, plyr in ipairs(players) do
            if plyr ~= player and plyr.Team and plyr.Team.Name == targetTeamName and plyr.Character and plyr.Character:FindFirstChild("Humanoid") and plyr.Character.Humanoid.Health > 0 then
                local targetRootPart = plyr.Character:FindFirstChild("HumanoidRootPart")
                if targetRootPart then
                    local totalDistance = (targetRootPart.Position - shooterPosition).magnitude
                    if totalDistance < shortestDistance then
                        closestPlayer = plyr
                        shortestDistance = totalDistance
                    end
                end
            end
        end
    else
        print("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ù„Ø§Ø­!")
    end

    return closestPlayer
end

-- Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ‚Ø¹ Ø­Ø±ÙƒØ© Ø§Ù„Ù‡Ø¯Ù
local function predictPosition(targetPosition, targetVelocity)
    local shooterPosition = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if shooterPosition then
        local distanceToTarget = (targetPosition - shooterPosition.Position).magnitude
        local predictionDistance = math.clamp(distanceToTarget, minPredictionDistance, maxPredictionDistance)
        local timeToImpact = predictionDistance / bulletSpeed
        return targetPosition + targetVelocity * timeToImpact
    end
    return targetPosition
end

-- Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ù
local function fireRemoteEvent(targetPlayer)
    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local currentTime = os.time()
        if currentTime - lastShotTime >= cooldown then
            local targetPosition = targetPlayer.Character.HumanoidRootPart.Position
            local targetVelocity = targetPlayer.Character.HumanoidRootPart.Velocity

            local predictedPosition = predictPosition(targetPosition, targetVelocity)

            local args = {
                [1] = predictedPosition,
                [2] = "Ù‚Ù†Ø§Øµ"
            }
            pcall(function()
                RemoteEvent:FireServer(unpack(args))
            end)

            -- ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ù„Ø§Ø­
            local tool = player.Character and player.Character:FindFirstChildOfClass("Tool")
            if tool then
                tool:Activate()
            end

            lastShotTime = currentTime
        end
    else
        print("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ Ù…Ø³ØªÙ‡Ø¯Ù!")
        displayNotification("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù„Ø§Ø¹Ø¨ Ù…Ù†Ø§Ø³Ø¨!")
    end
end

-- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
local function toggleTargetTeam()
    if targetTeamName == "Red" then
        targetTeamName = "Blue"
    else
        targetTeamName = "Red"
    end
    displayNotification("ğŸ¯ Ø§Ù„Ø¢Ù† ØªØ³ØªÙ‡Ø¯Ù ÙØ±ÙŠÙ‚ " .. targetTeamName)
end

-- Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø±Ø³ÙˆÙ…ÙŠØ©
local gui = Instance.new("ScreenGui")
gui.Parent = game:GetService("CoreGui")

-- Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
local teamToggleButton = Instance.new("TextButton")
teamToggleButton.Parent = gui
teamToggleButton.Position = UDim2.new(0.7, 0, 0.1, 0)
teamToggleButton.Size = UDim2.new(0, 200, 0, 50)
teamToggleButton.Text = "ğŸ” ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù"
teamToggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
teamToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
teamToggleButton.MouseButton1Click:Connect(toggleTargetTeam)

-- Ø²Ø± Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø£Ù‚Ø±Ø¨ Ù„Ø§Ø¹Ø¨
local targetButton = Instance.new("TextButton")
targetButton.Parent = gui
targetButton.Position = UDim2.new(0.7, 0, 0.25, 0)
targetButton.Size = UDim2.new(0, 200, 0, 50)
targetButton.Text = "ğŸ¯ Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø£Ù‚Ø±Ø¨ Ù„Ø§Ø¹Ø¨"
targetButton.BackgroundColor3 = Color3.fromRGB(0, 128, 255)
targetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
targetButton.MouseButton1Click:Connect(function()
    fireRemoteEvent(findClosestPlayer())
end)
